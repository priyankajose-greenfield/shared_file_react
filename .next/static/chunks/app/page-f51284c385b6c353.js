(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2412:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>b});var l=i(5155),r=i(2115),a=i(1259),n=i(851),s=i(3315),d=i(690),c=i(3077),o=i(9),u=i(1521),h=i(5068),m=i(7809);let x="shared_json_file_handle_v1";async function j(){try{let[e]=await window.showOpenFilePicker({types:[{description:"JSON",accept:{"application/json":[".json"]}}],excludeAcceptAllOption:!0,multiple:!1});return e}catch(e){return(null==e?void 0:e.name)!=="AbortError"&&console.error("File pick error",e),null}}async function y(e){let t=await e.getFile(),i=await t.text();try{let e=JSON.parse(i);return Array.isArray(e)?e:[]}catch(e){return[]}}async function f(e,t){let i=await e.createWritable();await i.write(JSON.stringify(t,null,2)),await i.close()}let p=h.Ik({name:h.Yj().required("Required"),email:h.Yj().email("Invalid email").required("Required"),phone:h.Yj().required("Required"),address:h.Yj().required("Required"),gender:h.Yj().required("Required"),age:h.ai().typeError("Must be a number").min(0,"Must be >= 0").required("Required")}),A={name:"",email:"",phone:"",address:"",gender:"",age:""};function v(e){let{db:t}=e;return(0,l.jsx)(a.A,{variant:"outlined",sx:{p:2,maxHeight:260,overflow:"auto",fontSize:12,whiteSpace:"pre"},children:JSON.stringify(t,null,2)})}let S=e=>{let{name:t,label:i,type:r="text",select:a=!1,children:n}=e,{getFieldProps:s,touched:d,errors:c}=(0,u.j7)(),o=s(t),h=d[t]&&c[t];return(0,l.jsx)(m.A,{...o,label:i,type:r,select:a,fullWidth:!0,size:"small",error:!!h,helperText:h||" ",children:a&&n})};function b(){let[e,t]=(0,r.useState)(null),[i,a]=(0,r.useState)([]),[h,m]=(0,r.useState)("Idle"),[b,w]=(0,r.useState)(!1),[g,O]=(0,r.useState)(null);(0,r.useEffect)(()=>{O("undefined"!=typeof navigator?navigator.onLine:null),function(){try{return"1"===localStorage.getItem(x)}catch(e){return!1}}()&&m("Re-select previously used shared JSON file");let e=()=>O(!0),t=()=>O(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);let k=(0,r.useCallback)(async()=>{w(!0);try{let e=await j();if(e){t(e);try{localStorage.setItem(x,"1")}catch(e){}let i=await y(e);a(i),m("Loaded shared file")}else m("Cancelled selection")}finally{w(!1)}},[]),N=async(t,l)=>{if(!e)return void alert("Pick the shared JSON file first.");try{let r=[...i,t];if(await f(e,r),a(r),m("Saved locally"),navigator.onLine)try{await fetch("/api/submit",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}),m("Saved locally + sent")}catch(e){m("Saved locally; send failed")}l()}catch(e){m("Write failure")}};return(0,l.jsxs)(n.A,{sx:{maxWidth:920,mx:"auto",p:3},children:[(0,l.jsx)(s.A,{variant:"h4",gutterBottom:!0,children:"LAN Shared Form"}),(0,l.jsx)(s.A,{variant:"body2",sx:{mb:2},children:"Pick a shared JSON file. All users must pick the SAME file."}),(0,l.jsx)(n.A,{sx:{display:"flex",gap:2,alignItems:"center",flexWrap:"wrap",mb:2},children:(0,l.jsx)(d.A,{variant:"contained",onClick:k,disabled:b,children:e?"Re-Pick JSON File":b?"Pickingâ€¦":"Pick Shared JSON File"})}),(0,l.jsx)(u.l1,{initialValues:A,validationSchema:p,onSubmit:(e,t)=>N(e,t.resetForm),children:t=>{let{isSubmitting:i}=t;return(0,l.jsx)(u.lV,{children:(0,l.jsxs)(c.Ay,{container:!0,spacing:2,children:[(0,l.jsx)(c.Ay,{item:!0,xs:12,sm:6,children:(0,l.jsx)(S,{name:"name",label:"Name"})}),(0,l.jsx)(c.Ay,{item:!0,xs:12,sm:6,children:(0,l.jsx)(S,{name:"email",label:"Email",type:"email"})}),(0,l.jsx)(c.Ay,{item:!0,xs:12,sm:6,children:(0,l.jsx)(S,{name:"phone",label:"Phone"})}),(0,l.jsx)(c.Ay,{item:!0,xs:12,sm:6,children:(0,l.jsx)(S,{name:"address",label:"Address"})}),(0,l.jsx)(c.Ay,{item:!0,xs:12,sm:6,children:(0,l.jsxs)(S,{name:"gender",label:"Gender",select:!0,children:[(0,l.jsx)(o.A,{value:"",children:"Select Gender"}),(0,l.jsx)(o.A,{value:"Male",children:"Male"}),(0,l.jsx)(o.A,{value:"Female",children:"Female"}),(0,l.jsx)(o.A,{value:"Other",children:"Other"})]})}),(0,l.jsx)(c.Ay,{item:!0,xs:12,sm:6,children:(0,l.jsx)(S,{name:"age",label:"Age",type:"number"})}),(0,l.jsx)(c.Ay,{item:!0,xs:12,children:(0,l.jsx)(d.A,{type:"submit",variant:"contained",disabled:i||!e,children:"Submit"})})]})})}}),(0,l.jsxs)(n.A,{sx:{mt:4},children:[(0,l.jsx)(s.A,{variant:"h6",gutterBottom:!0,children:"Current Data"}),(0,l.jsx)(v,{db:i})]})]})}},3074:(e,t,i)=>{Promise.resolve().then(i.bind(i,2412))}},e=>{e.O(0,[650,136,441,255,358],()=>e(e.s=3074)),_N_E=e.O()}]);